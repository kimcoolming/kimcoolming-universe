import{e as n,f as M,g as i,b as a,a as F,h as k,w,r as P,t as d,F as V,i as q,o as r,c as I,j as N}from"./index-B01RM12k.js";import{s as E,o as L,q as x,l as S,a as j,b as C,c as m,g as G,d as c,e as D,f as H,h as T,i as W}from"./firebase-DnhTk4aq.js";const Y={style:{"max-width":"700px",margin:"auto",padding:"2rem"}},z={style:{"margin-bottom":"1rem"}},J={key:0},K={style:{border:"1px solid #ddd","border-radius":"8px",padding:"1rem","margin-bottom":"1rem",position:"relative",cursor:"pointer"}},O=["onClick"],Q={style:{color:"gray"}},R={key:1},U=["disabled"],X={key:2,style:{"text-align":"center","margin-top":"1rem"}},f=5,at={__name:"GuestBoard",setup(Z){const u=n([]),g=n(null),l=n(!1),v=n(!1),h=n(0),_=n(1),p=n(null);M(()=>{E(D,"test@test.com","123456").catch(console.error),L(D,e=>{p.value=e,$(),y()})});const $=async()=>{const e=await H(m(c,"posts"));h.value=e.data().count},y=async()=>{if(l.value||v.value)return;l.value=!0;const e=g.value?x(m(c,"posts"),C("createdAt","desc"),j(g.value),S(f)):x(m(c,"posts"),C("createdAt","desc"),S(f)),t=await G(e),s=t.docs.map(o=>({id:o.id,...o.data()}));u.value.push(...s),t.docs.length<f&&(v.value=!0),t.docs.length>0&&(g.value=t.docs[t.docs.length-1]),_.value++,l.value=!1},A=e=>{if(!(e!=null&&e.toDate))return"";const t=e.toDate();return`${t.getFullYear()}.${String(t.getMonth()+1).padStart(2,"0")}.${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},B=async e=>{var s;if(((s=p.value)==null?void 0:s.uid)!==e.userId){alert("본인만 삭제할 수 있어요.");return}confirm("정말 삭제할까요?")&&(await T(W(c,"posts",e.id)),u.value=u.value.filter(o=>o.id!==e.id),h.value--)};return(e,t)=>{const s=P("router-link");return r(),i("div",Y,[t[1]||(t[1]=a("h2",null,"📖 방명록",-1)),F(s,{to:"/guest-board/write"},{default:w(()=>t[0]||(t[0]=[a("button",{style:{"margin-bottom":"1rem"}},"✍ 글쓰기",-1)])),_:1}),a("p",z,"전체 "+d(h.value)+"개의 글이 있습니다. ("+d(_.value-1)+" 페이지)",1),u.value.length===0&&!l.value?(r(),i("div",J,"아직 등록된 글이 없어요.")):k("",!0),(r(!0),i(V,null,q(u.value,o=>(r(),I(s,{key:o.id,to:`/guest-board/${o.id}`,style:{"text-decoration":"none",color:"inherit",display:"block"}},{default:w(()=>{var b;return[a("div",K,[((b=p.value)==null?void 0:b.uid)===o.userId?(r(),i("button",{key:0,onClick:N(tt=>B(o),["stop"]),style:{position:"absolute",top:"10px",right:"10px",background:"transparent",border:"none",color:"red","font-weight":"bold",cursor:"pointer"}}," ✕ ",8,O)):k("",!0),a("p",null,[a("strong",null,d(o.nickname),1),a("span",Q,"| "+d(A(o.createdAt)),1)]),a("p",null,d(o.message),1)])]}),_:2},1032,["to"]))),128)),v.value?(r(),i("div",X,"모든 글을 불러왔습니다.")):(r(),i("div",R,[a("button",{onClick:y,disabled:l.value,style:{width:"100%","margin-top":"1rem"}},d(l.value?"불러오는 중...":"더 보기"),9,U)]))])}}};export{at as default};
